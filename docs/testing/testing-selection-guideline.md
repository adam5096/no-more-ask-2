
## 選擇測試對象指南

### 目標
在有限人力/時間下，優先測高價值邏輯，避免低價值覆蓋造成維護負擔。

### 優先測（高 ROI）
- **純函式 / 核心邏輯**：計算、驗證、轉換、過濾、權限判斷。
- **對外契約 / 輸入輸出格式**：API handler 的主要分支與狀態碼（400/409/200…），回應格式、敏感欄位過濾。
- **高風險 / 高變動點**：業務關鍵流程、複雜錯誤處理、邊界條件。
- **安全 / 資料完整性**：涉及隱私或敏感資料的處理分支。

### 選測（中 ROI）
- **輕量 handler 測試**（如 Nitro eventHandler）：mock I/O、覆蓋主要分支即可。
- **Facade/組合層**：將多個純函式組合並含少量副作用者，測 happy/sad path。

### 可不測或改手動/冒煙（低 ROI）
- **薄封裝 / pass-through**：僅轉呼叫、無實質邏輯。
- **UI 細節與微交互**：易碎、維護成本高，改為人工冒煙或設計檢視。
- **外部系統整合 / 真網路**：優先 stub/contract；必要時改手動驗收。

### 管理與落地
- **分類自評**：每個變更標記為必測 / 選測 / 可不測，寫入 PR 或任務模板。
- **兄弟目錄 (Co-location)**：測試檔與生產檔相鄰，方便維護與缺口發現。
- **場景清單**：維護 P0/P1 場景（如 `register-test-scenarios.md`）；P0 必測，P1 視人力補充或改手動。
- **純函式化策略**：將 handler 的核心邏輯抽成純函式，重點測純函式；handler 僅保留少量「輸入/輸出/錯誤碼」測試。
- **避免過度覆蓋**：薄封裝或低風險邏輯可跳過，專注高價值分支。